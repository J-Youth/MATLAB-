# 实验目的

- 借助基础实验篇编制的程序，对语音信号进行处理；
- 充分了解信号处理及数字信号处理的过程；
- 灵活应用自己设计的频谱分析程序与滤波器程序；
- 使得学生能够综合分析信号处理过程各个阶段信号时域与频域特性。  

# 实验原理

语言信息主要包含在语音信号的参数之中，因此准确而迅速地提取语言信号的参数是进行语音信号处理的关键。常用的语音信号参数有：共振峰幅度、频率与带宽、音调和噪音、噪音的判别等。后来又提出了线性预测系数、声道反射系数和倒谱参数等参数。这些参数仅仅反映了发音过程中的一些平均特性，而实际语言的发音变化相当迅速，需要用非平稳随机过程来描述，因此，20世纪80年代之后，研究语音信号非平稳参数分析方法迅速发展，人们提出了一整套快速的算法，还有利用优化规律实现以合成信号统计分析参数的新算法，取得了很好的效果。

考虑到现有的学习情况，依靠$IIR$ 和$FIR$ 滤波器对语音信号进行滤波，可以算是对$Speech \ Signal \ Processing$ 的初步探索，值得一试！

另外，为熟练 $appdesigner$的使用，滤波的整个过程将通过$MATLAB$ 的$GUI$ 来呈现，使其更加直观、清晰。

# 实验内容

1. 录制一段各人自己的语音信号；
2. 对录制的信号进行采样；画出采样后语音信号的时域波形和频谱图；
3. 给定滤波器的性能指标，采用窗函数法或双线性变换设计滤波器，并画出滤波器的频率响应；  
4. 用自己设计的滤波器对采集的语音信号进行滤波，画出滤波后信号的时域波形和频谱； 
5. 对滤波前后的信号进行对比，分析信号的变化；  
6. 回放语音信号，并与录制语音信号比较； 
7. 设计出一信号处理系统界面。   

# 相关核心组件

在使用$appdesigner$ 的过程中，必然会用到组件。下图所示为常用组件。

<img src="https://gitee.com/MetaYouth/picture/raw/master/image/image-20220411160233341.png" alt="image-20220411160233341" style="zoom:50%;" />

而在本次试验中所涉及到的核心组件如下所列：

1. 下拉框
2. 切换按钮组
3. 单选按钮组
4. 图像
5. 坐标区
6. 按钮
7. 标签
8. 滑块
9. 编辑字段（数值）

# 操作流程

<img src="https://gitee.com/MetaYouth/picture/raw/master/image/%E8%AF%AD%E9%9F%B3%E4%BF%A1%E5%8F%B7%E5%A4%84%E7%90%86.png" alt="|Figure 1 语音信号处理流程图" style="zoom: 15%;" />

# 总体框架概览

## 启动提示窗口

如下图所示，$app$在启动时将弹出一个表示开发中的窗口，表明当前的软件功能并不完善，未来或将持续改进。

可直接点击“确定”进行下一步操作。

![Figure 2 app启动提示](https://img-blog.csdnimg.cn/img_convert/87e4ed74ea4f1deb0489480edec01fc0.png)

## 三大功能界面

如图所示，进入$app$，可以发现软件名称修改成了“Voice Signal Processing”，同时，其主要功能被选项卡组划分成了三个主要界面——原始声音信号来源、加入噪声类型、滤波器选型。

![image-20220411160834466](https://img-blog.csdnimg.cn/img_convert/fd4cbfb3b1467c766c65a3de4cc14048.png)

![image-20220411161121933](https://img-blog.csdnimg.cn/img_convert/c668b15268b545621a1d39853291c6bd.png)

![image-20220411161138636](https://img-blog.csdnimg.cn/img_convert/494070b782b4cd76a466abf85923f000.png)

## 界面结构说明

以上三个界面布局结构大致相同，以“滤波器选型”为例，界面可分为三大部分——滤波器特性及参数选择区、滤波器特性展示区、信号动态变化区。如下图所示。

![image-20220411162348238](https://img-blog.csdnimg.cn/img_convert/3c631ce4bdf148038d7377eafbf195ed.png)

其中，信号动态变化区设置的层级高于这三个界面，因此不管切换到哪一个界面，信号动态变化区都不会有变化。与此相反，前两部分（在“滤波器选型”界面为“滤波器特性及参数选择区”和“滤波器特性展示区”）因为设置为隶属于界面下的下一层级，所以这两部分会随着界面的切换而变化。

信号动态变化区从左到右分别展示了原始信号、加噪后信号、滤波后信号，分别对应三个窗口。第一行展示时域的变化，第二行展示频域的变化。综合看时频域变化图可以更清晰地分析整个信号的变化过程及滤波效果。

此外，每一个界面的右上角位置都摆放了一个$voice$的图标，点击可播放不同时刻的声音。对应于信号动态变化区的三个时频域信号，$voice$分别为原始信号的声音、加噪后信号的声音和滤波后信号的声音。通过播放这些不同时刻的声音，可以更亲切地感受信号变化的过程，更直观地判断滤波的效果。

# $APP$ 运行演示

## 界面一：原始声音信号来源

#### 操作流程

1. 首先，选择声音来源是本地文件还是现场实时录音；
2. 本地文件为录制好的四个音频文件，包括$m4a$和$wav$格式的，可选其一；
3. 现场实时录音可选择录音时长（$5s/10s/15s/20s$）,可选其一并开始录音，录音文件将保存在本地文件夹(./语音库)中；
4. 选择好后，相应语音文件的时域和频域曲线将在下方坐标区显示；
5. 如果什么都不想选，可点击“使用默认文件”按钮，后台已设置好默认语音文件；
6. 点击右上角的$voice$的图标，可以播放最近一次选择的音频。

#### 操作演示

##### 选择现场实时录音

1. 如果选择“现场实时录音”中的“$5s$”，将出现如下的提示框。![image-20220411173721728](https://img-blog.csdnimg.cn/img_convert/e480f01f22c70f2b2d0f38fa8aef16ff.png)
2. 此时请开始录音至录音结束。
3. 录音结束时提示框会显示出刚刚的录音时域波形，如图。![image-20220411173740494](https://img-blog.csdnimg.cn/img_convert/70a775482f4175362d1eae807c569842.png)
4. 在点击确定后，软件已完成对录音音频的分析，界面将同时显示其时域和频域波形。如图。

![image-20220411173818310](https://img-blog.csdnimg.cn/img_convert/76fe58b4d7991b31511f444c5273b8fd.png)

##### 选择本地语音文件

选择本地录音文件中的“$luyin$”，软件将读取本地文件中的“$luyin.m4a$”文件并进行分析，界面将同时显示其时域和频域波形。如图。后面的步骤将以本语音文件为基础。

![image-20220411175603158](https://img-blog.csdnimg.cn/img_convert/a49d626d4e1df725304aac916bc0a104.png)

## 界面二：加入噪声类型

#### 操作流程

1. 选择希望加入的噪声形式；
2. 随机信号中可选择高斯噪声或均匀噪声，界面左侧的坐标区中会显示其时频域特性曲线；
3. 单频噪声为正弦信号，可以通过滑块调节其频率，旁边的文本框将随着滑块的移动实时显示其具体频率；
4. 多频噪声为六个不同频率的正弦信号叠加，可更改对应频率后的文本框中数字调整各个正弦信号的频率；
5. 点击“噪声叠加”的按钮，将原始信号与噪声进行叠加，并在界面中间的加噪信号的坐标区中绘出其时频域曲线；
6. 若选择无噪，则将以原始信号作为加噪信号，并进行和有噪信号同样的操作；
7. 点击右上角的$voice$的图标，可以播放加噪后的音频，直观感受加噪信号与原始信号的区别。

#### 操作演示

##### 无噪声

将“NO NOISE ？”的开关拨至“ON”，将弹出如图所示的对话框：![image-20220411182426078](https://img-blog.csdnimg.cn/img_convert/6038cd2647f15be8a2e4cf5596cdc913.png)

若点击“Yes”，将不会对原始信号添加噪声。此时噪声信号为0，加噪信号为原始信号，界面将出现加噪后的语音信号时频域波形图。如下所示。

[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-XY3VP2iZ-1680246145385)(null)]

##### 随机噪声

如下分别是选择均匀噪声和高斯噪声的信号变化情况。

![image-20220411185114891](https://img-blog.csdnimg.cn/img_convert/67700d9c75735649e5fab81c954d7eb4.png)

![image-20220411185149436](https://img-blog.csdnimg.cn/img_convert/68d23982f8ca63cb2fb25d238fe7de3d.png)

##### 单频正弦噪声

如下是选择单频正弦噪声的信号变化情况。（接下来的滤波操作以叠加了$8k$ Hz正弦信号的加噪信号为基础）

[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-ivpbaJXk-1680246145118)(null)]

##### 多频噪声

如下是选择多频正弦合成噪声的信号变化情况。

![image-20220411185507709](https://img-blog.csdnimg.cn/img_convert/c5cd83c6855e3464eba1db78c7947a84.png)

## 界面三：滤波器选型

#### 操作流程

1. 综合考虑噪声信号的频率和语音信号的频率，合理设置低通滤波器的通带截止频率和阻带截至频率；
2. 选择$IIR$ 滤波器还是 $FIR$ 滤波器；
3. 若选择$IIR$ 滤波器，请继续选择是利用脉冲响应不变变换法来滤波还是双线性变换，界面左侧的坐标区中会显示其频域特性曲线；
4. 若选择$FIR$ 滤波器，请继续选择窗函数的类型（已预设六种窗函数），界面左侧的坐标区中会显示其频域特性曲线；
5. 点击“开始滤波”按钮，界面中间的滤波信号的坐标区中绘出滤波后的时频域曲线；
6. 点击右上角的$voice$的图标，可以播放滤波后的音频，感受滤波效果是否明显，对比滤波信号与原始信号的区别。

#### 操作演示

由于前一步加入的噪声为$8k$ Hz正弦信号，结合语音信号频率一般不超过3400 Hz，可设置低通滤波器通带截频为4000 Hz，阻带截频为6000 Hz。

如下分别为选择不同滤波器的幅频特性曲线：

1. 脉冲响应不变变换法
2. 双线性变换法
3. 矩形窗
4. 巴特利特窗
5. 哈明窗
6. 汉明窗
7. 布莱克曼窗
8. 凯塞窗

![image-20220411192011589](https://img-blog.csdnimg.cn/img_convert/2ed4f8f1f9d6cca1ebbaf04a3ff8a9b3.png)![image-20220411192034264](https://img-blog.csdnimg.cn/img_convert/ed62f3739842e45ed176f120a10f7983.png)

![image-20220411192116501](https://img-blog.csdnimg.cn/img_convert/ea6d5a8376c35bee24194d2d83bf3a58.png)![image-20220411192227906](https://img-blog.csdnimg.cn/img_convert/1e84198313343e402828b69a82e8ebf2.png)

![image-20220411192306055](https://img-blog.csdnimg.cn/img_convert/ef8b1ecd3eb733bb307aa67a771663da.png)![image-20220411192326215](https://img-blog.csdnimg.cn/img_convert/85f300ad30815b6dd68b6843a38f69d4.png)

![image-20220411192350824](https://img-blog.csdnimg.cn/img_convert/6bfec6f9921db6af2945b9e6e3847d0c.png)![image-20220411192419649](https://img-blog.csdnimg.cn/img_convert/008d21eb2aa4d2991f5ce8526da5c0d6.png)



滤波效果类似，以下为选择布莱克曼窗滤波的效果。噪声信号得到了一定的滤除。

![image-20220411193500021](https://img-blog.csdnimg.cn/img_convert/0adf9ee33f5150a3c3c792ef44452271.png)

# 总结与评价

1. 滤波效果并不是特别理想，可能是代码中某些参数设置的不合适。比如在实验中我几乎全程用的都是使用$audioread$ 读取到的原始文件的采样值48000，对于一般的语音信号设的过高，实际情况一般取10000左右就差不多了；
2. $IIR$ 滤波器和$FIR$ 等普通的滤波器对于高斯白噪声这类频率范围极宽的干扰信号来说，属实显得有些无能为力，可以尝试使用语音增强算法等改良算法来充分滤波。
3. 实验中在做对信号做$FFT$时，如果不设置$N$，$MATLAB$ 算出来的频率响应一般是比较精确的，但本身取的N有时会很大，不便于计算。如果自己设置$N$，想要找到合适长度的$N$，就需要一次一次的尝试，在长度和精确性之间做权衡。
4. 网上多数教程，包括学习通的视频，都是用guide命令来做的$GUI$，但我目前使用的$MATLAB2021B$ 已经警告说不建议使用guide，并将不再维护，建议使用$appdesigner$。这也是我使用$appdesigner$来做的原因。虽然$appdesigner$界面趋于扁平化，更加美观，但很难在不同版本之间直接共享，还需额外安装对应版本的runtime文件。

# Appendix ：$MATLAB$源代码

## Appendix 1：利用$FFT$计算卷积

```matlab
% 自定义函数：利用FFT计算卷积
function [y,Yk,m] = fft_conv(xn,hn)
	N=length(xn)+length(hn)-1;%序列延长
	xn=[xn,zeros(1,N-length(xn))];%补零
	hn=[hn,zeros(1,N-length(hn))];%补零
	Xk=fft(xn);
	Hk=fft(hn);
	Yk=Xk.*Hk;
	y=ifft(Yk,N); %用FFT和IFFT
	m=0:(N-1);%卷积的自变量范围
end
```

## Appendix 2：计算滤波器的幅频响应，相位响应和群延迟

```matlab
function[dB,mag,pha,grd,w]=freqz_m(b,a)
% 滤波器的幅频响应，相位响应和群延迟
% dB 用dB表示的幅频响应
% mag 幅频响应的绝对值
% pha 相位响应
% grd 群延迟
% b,a 系统传递函数对应的系数
% w 采样频率
[H,w]=freqz(b,a,100000,'whole');
H=(H(1:50001))';
w=(w(1:50001))';
mag=abs(H);
dB=20*log10((mag+eps)/max(mag));
pha=angle(H);
grd=grpdelay(b,a,w);
end
```

## Appendix 3：计算理想低通冲激响应

```matlab
%理想低通冲激响应计算函数
function hd=ideal_lp(wc,N)
alpha=(N-1)/2;
n=0:N-1;
m=n-alpha+eps;
hd=sin(wc*m)./(pi*m);
end
```

## Appendix 4 ：$appdesigner$ 主程序

具体实现见2.2appdesigner.m的程序
